name: Get list of monorepo lambdas
description: Return list of monorepo lambdas or empty list if not a monorepo.

outputs:
  lambdas:
    value: ${{ steps.step1.outputs.lambdas }}

runs:
  using: "composite"
  steps:
    - name: get stuff
      id: step1
      uses: actions/github-script@v6
      with:
        script: |
          const fs = require('fs');
          
          // Function to get current filenames 
          // in directory 
          filenames = fs.readdirSync('src/'); 

          let results = []
          console.log("\nCurrent directory filenames:"); 
          filenames.forEach(file => { 
            if( fs.statSync(file).isDirectory() ) {
              console.log(file);
              results.push(file);
            }
          });
          
    - id: step2
      shell: python
      run: |
        import json
        import sys
        import os

        dir = "src/lambdas"
        count = 0
        lambdas = ""
        if os.path.isdir(dir):
          #  lambdas = [name for name in os.listdir(dir) if os.path.isdir(os.path.join(dir, name))]
          for name in os.listdir(dir):
            if count == 0:
              lambdas = name
            else:
              lambdas = lambdas + "," + name
            count += 1

        outputs_file = os.getenv("GITHUB_OUTPUT")
        with open(outputs_file, "a") as f:
          f.write(f"lambdas=[{lambdas}]")
